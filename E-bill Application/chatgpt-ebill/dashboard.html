<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - M-POS</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

  <header class="navbar">
    <h2 class="logo">M-POS</h2>
    <nav>
      <a href="index.html">POS</a>
      <a class="active">Dashboard</a>
      <a href="expenses.html">Expenses</a>
      <a href="products.html">Products</a>
      <a href="reports.html">Reports</a>
      <a href="transactions.html">Transactions</a>
      <div class="profile-container">
        <div class="profile-icon" id="profileIcon">ðŸ‘¤</div>
        <div class="profile-dropdown" id="profileDropdown">
          <div class="dropdown-item" id="userNameDisplay">Name</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" onclick="logout()">Logout</div>
        </div>
      </div>
    </nav>
  </header>

  <main class="dashboard-container">
    <div class="dashboard-controls">
      <h1>Analytics Overview</h1>
      <div class="date-filters">
        <select id="dateRange" class="filter-select" onchange="handleDateRangeChange()">
          <option value="today" selected>Today</option>
          <option value="yesterday">Yesterday</option>
          <option value="last7">Last 7 Days</option>
          <option value="thisMonth">This Month</option>
          <option value="lastYear">Last 12 Months</option>
          <option value="custom">Custom Range</option>
        </select>
        <div id="customDateRange" class="custom-range">
          <input type="date" id="startDate" class="date-input">
          <span>to</span>
          <input type="date" id="endDate" class="date-input">
          <button onclick="loadStats()" class="page-btn">Apply</button>
        </div>
      </div>
    </div>

    <!-- KPI Cards Section -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Total Revenue</div>
        <p class="stat-value" id="revenue">â‚¹0</p>
        <div class="stat-subvalue" id="grossRevenue">Gross: â‚¹0</div>
        <div id="revenueTrend" class="trend-badge trend-neutral">--%</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Orders</div>
        <p class="stat-value" id="orders">0</p>
        <div id="ordersTrend" class="trend-badge trend-neutral">--%</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Average Order Value</div>
        <p class="stat-value" id="avgOrder">â‚¹0</p>
        <div id="aovTrend" class="trend-badge trend-neutral">--%</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Peak Order Time</div>
        <p class="stat-value" id="peakTime" style="font-size: 1.5rem;">--:--</p>
        <div class="stat-subvalue">Based on frequency</div>
      </div>
    </div>

    <!-- Charts Row 1 -->
    <div class="charts-row">
      <div class="chart-card">
        <div class="chart-header">
          <h3>Revenue & Sales Trend</h3>
        </div>
        <canvas id="revenueChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-header">
          <h3>Order Sources</h3>
        </div>
        <canvas id="platformChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-header">
          <h3>Top 5 Best Selling Products</h3>
          <button onclick="showBestSellingModal()" class="page-btn small">Show All</button>
        </div>
        <div id="bestSellingList" class="best-selling-list">
          <!-- Top 5 products injected here -->
        </div>
      </div>
    </div>

    <!-- Charts Row 2 -->
    <div class="charts-row">
      <div class="chart-card">
        <div class="chart-header">
          <h3>Daily Order Volume</h3>
        </div>
        <canvas id="orderVolumeChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-header">
          <h3>Payment Modes</h3>
        </div>
        <div id="paymentModeStats" class="stats-grid-small">
          <!-- Stats injected here -->
        </div>
      </div>
    </div>

    <!-- Recent Orders Table Section -->
    <div class="dashboard-section">
      <div class="chart-header">
        <h2>Recent Transactions</h2>
        <button onclick="window.location.href='reports.html?tab=transactions'" class="page-btn">View All</button>
      </div>
      <div class="table-container" style="background: rgba(30, 41, 59, 0.4); border-radius: 1rem; padding: 1rem;">
        <table class="data-table" style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="text-align: left; color: var(--text-muted); border-bottom: 1px solid var(--border);">
              <th style="padding: 1rem;">Bill #</th>
              <th style="padding: 1rem;">Time</th>
              <th style="padding: 1rem;">Platform</th>
              <th style="padding: 1rem;">Method</th>
              <th style="padding: 1rem;">Gross</th>
              <th style="padding: 1rem;">Net Total</th>
            </tr>
          </thead>
          <tbody id="recentOrders">
            <!-- JS injected -->
          </tbody>
        </table>
        <div id="pagination" class="pagination" style="margin-top: 1rem; justify-content: center;"></div>
      </div>
    </div>
  </main>

  <div id="bestSellingModal" class="modal">
    <div class="modal-content" style="width: 800px; max-width: 95%;">
      <div class="modal-header">
        <h3>All Products Performance</h3>
        <span class="close" onclick="closeBestSellingModal()">&times;</span>
      </div>
      <div class="table-container" style="max-height: 400px; overflow-y: auto;">
        <table class="data-table" style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="text-align: left; color: var(--text-muted); border-bottom: 1px solid var(--border);">
              <th style="padding: 1rem;">Product Name</th>
              <th style="padding: 1rem;">Quantity Sold</th>
              <th style="padding: 1rem;">Total Revenue</th>
            </tr>
          </thead>
          <tbody id="allBestSellingProducts">
            <!-- All products injected here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script src="js/api.js"></script>
  <script src="js/common.js"></script>
  <script src="js/dashboard.js"></script>
</body>

</html>